<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quizterra | View Set</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body {margin:0; font-family:Poppins,sans-serif; display:flex; height:100vh; background:linear-gradient(120deg,#47a7ff,#745cff,#ff4ef2); background-size:400% 400%; animation:gradientMove 11s ease infinite; color:white; font-size:14px;}
@keyframes gradientMove{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
.sidebar{width:220px; background:#002b6f; padding:20px; height:100vh; box-shadow:2px 0 10px rgba(0,0,0,0.4);}
.sidebar h2{font-size:32px;margin-bottom:25px;color:#0fa6ff;font-weight:900;}
.sidebar a{display:flex;align-items:center;gap:12px;color:white;text-decoration:none;font-size:18px;font-weight:700;padding:10px 12px;border-radius:12px;margin-bottom:15px;transition:0.25s;}
.sidebar a:hover{background:rgba(255,255,255,0.15);}
.sidebar a.active{background:rgba(255,255,255,0.2);}
.main{flex:1;padding:30px;overflow-y:auto;}
.top-row{display:flex;justify-content:space-between;align-items:center;}
.create-btn{background:rgba(255,255,255,0.25);padding:10px 18px;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;color:white;transition:0.3s;}
.create-btn:hover{background:rgba(255,255,255,0.35);transform:scale(1.05);}

.set-card{background:rgba(255,255,255,0.18);padding:15px;border-radius:14px;backdrop-filter:blur(10px);box-shadow:0 8px 20px rgba(0,0,0,0.3);transition:0.3s;margin-bottom:15px;}
.set-card h3{margin:0 0 8px 0;font-size:20px;font-weight:700;}
.set-card p{font-size:13px;opacity:.9;}

.card-btns{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
.card-btns button{padding:6px 12px;border-radius:20px;border:none;font-weight:600;cursor:pointer;transition:0.3s;font-size:12px;}
.edit-btn{background:#ffa500;color:white;}
.edit-btn:hover{background:#ffb733;transform:scale(1.05);}
.delete-btn{background:#ff4e4e;color:white;}
.delete-btn:hover{background:#ff6b6b;transform:scale(1.05);}
.play-btn{background:#00ff95;color:black;}
.play-btn:hover{background:#33ffaa;transform:scale(1.05);}
.view-btn{background:#4ecbff;color:black;}
.view-btn:hover{background:#7edaff;transform:scale(1.05);}

.question-block{background:rgba(0,0,0,0.2);padding:12px;border-radius:12px;margin-bottom:15px;}
.question-block img{max-width:80%;height:auto;margin:4px 0;border-radius:6px;}

.answers div{margin:4px 0;padding:8px;background:rgba(255,255,255,0.1);border-radius:6px;color:white;font-size:13px;}
.correct{background:#00ff95;color:black;}

/* Typing answer style */
.typing-answer{
  background:#00c2ff !important;
  color:black;
  font-weight:700;
  border-left:4px solid white;
}
</style>
</head>
<body>
<div class="sidebar">
<h2>QUIZTERRA</h2>
<a href="stats.html"><i class="fas fa-chart-line"></i> Stats</a>
<a href="market.html"><i class="fas fa-store"></i> Market</a>
<a href="inventory.html"><i class="fas fa-box"></i> Inventory</a>
<a href="sets.html"><i class="fas fa-layer-group"></i> Sets</a>
<a id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
</div>

<div class="main">
<div class="top-row">
<h1 id="setTitle">Set Title</h1>
<button class="create-btn" id="shareBtn">Share / Copy Link</button>
</div>

<p id="privacyStatus"></p>
<div id="questionsContainer"></div>

<div class="card-btns" style="margin-top:15px;">
  <button class="play-btn" id="playSetBtn">Play Set</button>
</div>
</div>

<!-- SHARE MODAL -->
<div id="shareModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;">
<div style="background:white;padding:15px;border-radius:10px;width:300px;text-align:center;color:black;">
<h3>Share Link</h3>
<input id="shareInput" type="text" readonly style="width:100%;padding:6px;border-radius:5px;border:1px solid #ccc;">
<button id="copyBtn" style="margin-top:8px;padding:8px 12px;background:#4a60ff;color:white;border:none;border-radius:5px;cursor:pointer;">Copy</button>
<button id="closeModal" style="margin-top:8px;padding:8px 12px;background:#ccc;color:black;border:none;border-radius:5px;cursor:pointer;">Close</button>

<div id="platforms" style="margin-top:10px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
<button class="view-btn" onclick="shareToPlatform('classroom')">Google Classroom</button>
<button class="view-btn" onclick="shareToPlatform('blooket')">Blooket</button>
<button class="view-btn" onclick="shareToPlatform('gimkit')">Gimkit</button>
<button class="view-btn" onclick="shareToPlatform('knowt')">Knowt</button>
</div>
</div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const setId = params.get('setId');

let sets = JSON.parse(localStorage.getItem('quizterraSets') || '[]');
let setData = sets.find(s => s.id === setId);

let userLoggedIn = localStorage.getItem("quizterraUser") !== null;

const playBtn = document.getElementById('playSetBtn');

if(!setData){
  document.getElementById('setTitle').innerText='Set Not Found';
} else {
  document.getElementById('setTitle').innerText=setData.name;
  document.getElementById('privacyStatus').innerText='Privacy: '+(setData.privacy||'Public');

  const container = document.getElementById('questionsContainer');

  // Render questions & answers for everyone
  setData.questions.forEach((q, i) => {
    const div = document.createElement('div');
    div.className = 'question-block';

    if(q.type === "typing"){
      div.innerHTML = `
        <h3>Q${i+1}: ${q.question}</h3>
        ${q.image ? `<img src='${q.image}'>` : ""}
        <div class='answers'>
          <div class='typing-answer'>Typing Answer: <b>${q.correct}</b></div>
        </div>
      `;
    } else {
      div.innerHTML = `
        <h3>Q${i+1}: ${q.question}</h3>
        ${q.image ? `<img src='${q.image}'>` : ""}
        <div class='answers'>
          ${q.options.map(opt =>
            `<div class='${q.correct===opt ? "correct" : ""}'>${opt}</div>`
          ).join("")}
        </div>
      `;
    }

    container.appendChild(div);
  });
}

// Disable Play button for non-logged-in users
if(!userLoggedIn){
  playBtn.style.background = "gray";
  playBtn.style.cursor = "not-allowed";
  playBtn.style.opacity = "0.5";
  playBtn.innerText = "Login Required";
  playBtn.onclick = () => alert("You must be logged in to play game modes.");
} else {
  playBtn.onclick = () => {
    window.location = `https://historypenguin.github.io/quizterra/play.html?setId=${setId}`;
  };
}

// SHARE MODAL
const modal = document.getElementById('shareModal');
const shareInput = document.getElementById('shareInput');

document.getElementById('shareBtn').onclick = () => {
  shareInput.value = window.location.href;
  modal.style.display = 'flex';
};

document.getElementById('closeModal').onclick = () => {
  modal.style.display = 'none';
};

document.getElementById('copyBtn').onclick = () => {
  shareInput.select();
  document.execCommand('copy');
};

function shareToPlatform(platform){
  const url = encodeURIComponent(window.location.href);
  let shareUrl = "";
  switch(platform){
    case 'classroom': shareUrl=`https://classroom.google.com/share?url=${url}`;break;
    case 'blooket': shareUrl=`https://www.blooket.com/play?link=${url}`;break;
    case 'gimkit': shareUrl=`https://www.gimkit.com/share?url=${url}`;break;
    case 'knowt': shareUrl=`https://www.knowt.com/share?url=${url}`;break;
  }
  window.open(shareUrl,'_blank');
}
</script>
</body>
</html>
