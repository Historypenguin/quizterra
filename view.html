<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quizterra | View Set</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
  body {
    margin: 0;
    font-family: "Poppins", sans-serif;
    background: #f4f4f4;
  }

  .container {
    width: 90%;
    max-width: 900px;
    margin: 30px auto;
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }

  h1 { font-size: 32px; margin-bottom: 5px; }
  .description { font-size: 18px; opacity: 0.8; margin-bottom: 20px; }

  .question-box {
    border: 2px solid #ddd;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    background: #fafafa;
  }

  .question-box img {
    max-width: 200px;
    border-radius: 10px;
    margin-top: 10px;
  }

  .btn {
    padding: 12px 20px;
    background: #2575fc;
    border: none;
    color: white;
    border-radius: 10px;
    cursor: pointer;
    font-size: 18px;
    margin-right: 10px;
  }

  .btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  /* Share Modal */
  #shareModal {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.65);
    display: none;
    justify-content: center;
    align-items: center;
  }

  #shareBox {
    background: #fff;
    padding: 20px;
    width: 350px;
    border-radius: 10px;
    text-align: center;
  }

  .share-btn {
    background: #eee;
    border: none;
    padding: 10px;
    border-radius: 10px;
    width: 80%;
    cursor: pointer;
    margin-top: 10px;
    font-size: 18px;
  }
</style>

</head>
<body>

<div class="container">
  <h1 id="setName">Loading...</h1>
  <p id="setDesc" class="description"></p>

  <button id="playSetBtn" class="btn">Play Set</button>
  <button id="shareBtn" class="btn" style="background:#6a11cb;">Share</button>

  <h2>Questions</h2>
  <div id="questionList">Loading questions...</div>
</div>

<!-- SHARE MODAL -->
<div id="shareModal">
  <div id="shareBox">
    <h2>Share Set</h2>

    <button class="share-btn" onclick="shareToPlatform('classroom')">Google Classroom</button>
    <button class="share-btn" onclick="shareToPlatform('blooket')">Blooket</button>
    <button class="share-btn" onclick="shareToPlatform('gimkit')">Gimkit</button>
    <button class="share-btn" onclick="shareToPlatform('knowt')">Knowt</button>
    <button class="share-btn" onclick="shareToPlatform('inquiziti')">Inquiziti</button>

    <button class="share-btn" onclick="closeShare()">Close</button>
  </div>
</div>

<script>
// Extract setId from URL
const urlParams = new URLSearchParams(window.location.search);
const setId = urlParams.get("id");

// ----- LOAD SET (PUBLIC OR PRIVATE) -----
let sets = JSON.parse(localStorage.getItem("quizterraSets")) || {};
let setData = sets[setId];

if (!setData) {
  document.getElementById("setName").innerText = "Set Not Found";
  document.getElementById("setDesc").innerText = "This set may have been deleted or is private.";
} else {
  // Show data publicly
  document.getElementById("setName").innerText = setData.name;
  document.getElementById("setDesc").innerText = setData.description;

  let qList = document.getElementById("questionList");
  qList.innerHTML = "";

  setData.questions.forEach(q => {
    let div = document.createElement("div");
    div.className = "question-box";

    div.innerHTML = `
      <b>${q.question}</b><br>
      ${q.image ? `<img src="${q.image}">` : ""}
      <br><br>
      <i>Correct Answer:</i> ${q.correct}
    `;
    qList.appendChild(div);
  });
}

// ----- PLAY BUTTON LOGIN CHECK -----
let loggedIn = localStorage.getItem("quizterraUser");

if (!loggedIn) {
  const playBtn = document.getElementById("playSetBtn");
  playBtn.disabled = true;
  playBtn.innerText = "Login Required";
}

// Only allow play if logged in
document.getElementById("playSetBtn").onclick = () => {
  let loggedIn = localStorage.getItem("quizterraUser");

  if (!loggedIn) {
    alert("You must be logged in to play this set.");
    return;
  }

  window.location = `play.html?id=${setId}`;
};

// ----- SHARE MODAL -----
document.getElementById("shareBtn").onclick = () => {
  document.getElementById("shareModal").style.display = "flex";
};

function closeShare() {
  document.getElementById("shareModal").style.display = "none";
}

function shareToPlatform(platform) {
  const url = encodeURIComponent(window.location.href);
  let shareUrl = "";

  switch (platform) {
    case "classroom": shareUrl = `https://classroom.google.com/share?url=${url}`; break;
    case "blooket":   shareUrl = `https://www.blooket.com/play?link=${url}`; break;
    case "gimkit":    shareUrl = `https://www.gimkit.com/share?url=${url}`; break;
    case "knowt":     shareUrl = `https://www.knowt.com/share?url=${url}`; break;
    case "inquiziti": shareUrl = `https://inquiziti.com/share?link=${url}`; break;
  }

  window.open(shareUrl, "_blank");
}
</script>

</body>
</html>
