<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quizterra | View Set</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {margin:0;font-family:Poppins,sans-serif;background:#f4f4f4;}
    .navbar{background:#4a60ff;color:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;}
    .container{max-width:900px;margin:30px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.1);overflow-y:auto;max-height:75vh;}
    h1{margin-top:0;font-size:28px;font-weight:700;}
    .question{background:#f7f7f7;padding:15px;border-radius:10px;margin-bottom:15px;border-left:5px solid #4a60ff;}
    .question h3{margin:0 0 10px;font-size:20px;}
    .answers div{margin:5px 0;padding:10px;background:#ececec;border-radius:5px;}
    .correct{background:#b2ffb2 !important;}
    #privacyStatus{margin-top:10px;font-weight:600;color:#4a60ff;}
    #shareBtn{padding:10px 15px;background:#4a60ff;color:white;border:none;border-radius:5px;cursor:pointer;margin-bottom:10px;}
    #shareModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;}
    #shareModalContent{background:white;padding:20px;border-radius:10px;width:320px;text-align:center;}
    #shareInput{width:100%;padding:8px;border-radius:5px;border:1px solid #ccc;}
    #copyBtn{margin-top:10px;padding:10px 15px;background:#4a60ff;color:white;border:none;border-radius:5px;cursor:pointer;}
    #closeModal{margin-top:10px;padding:10px 15px;background:#ccc;color:black;border:none;border-radius:5px;cursor:pointer;}
    #platforms{margin-top:15px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap;}
    .platformBtn{padding:8px 12px;background:#0fa6ff;color:white;border:none;border-radius:5px;cursor:pointer;font-size:14px;}
  </style>
</head>
<body>
  <div class="navbar">
    <h2>Quizterra</h2>
    <a href="mysets.html" style="color:white;text-decoration:none;font-weight:600">My Sets</a>
  </div>

  <div class="container">
    <h1 id="setTitle">Set Title</h1>
    <p id="privacyStatus"></p>
    <button id="shareBtn">Share</button>

    <div id="questionsContainer"></div>
  </div>

  <!-- SHARE MODAL -->
  <div id="shareModal">
    <div id="shareModalContent">
      <h3>Share Link</h3>
      <input id="shareInput" type="text" readonly>
      <button id="copyBtn">Copy</button>
      <button id="closeModal">Close</button>
      <div id="platforms">
        <button class="platformBtn" onclick="shareToPlatform('classroom')">Google Classroom</button>
        <button class="platformBtn" onclick="shareToPlatform('blooket')">Blooket</button>
        <button class="platformBtn" onclick="shareToPlatform('gimkit')">Gimkit</button>
        <button class="platformBtn" onclick="shareToPlatform('knowt')">Knowt</button>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const setId = params.get("id");
    let sets = JSON.parse(localStorage.getItem("quizterraSets") || "[]");
    let setData = sets.find(s=>s.id===setId);

    if(!setData){document.getElementById("setTitle").innerText="Set Not Found";} 
    else {
      document.getElementById("setTitle").innerText = setData.name;
      document.getElementById("privacyStatus").innerText = 'Privacy: ' + (setData.privacy||'Public');
      const container = document.getElementById("questionsContainer");
      setData.questions.forEach((q,i)=>{
        const div = document.createElement("div");
        div.className="question";
        div.innerHTML=`<h3>Q${i+1}: ${q.question}</h3><div class='answers'>${q.options.map((opt,j)=>`<div class='${q.correct===opt?'correct':''}'>${opt}</div>`).join('')}</div>`;
        container.appendChild(div);
      });
    }

    // MODAL AND COPY
    const modal=document.getElementById('shareModal');
    const shareInput=document.getElementById('shareInput');
    const copyBtn=document.getElementById('copyBtn');
    const closeModal=document.getElementById('closeModal');
    const shareBtn=document.getElementById('shareBtn');

    shareBtn.onclick=()=>{
      shareInput.value=window.location.href;
      modal.style.display='flex';
    };

    copyBtn.onclick=()=>{
      shareInput.select();
      shareInput.setSelectionRange(0,99999);
      document.execCommand('copy');
      copyBtn.innerText='Copied!';
      setTimeout(()=>{copyBtn.innerText='Copy';},1200);
    };

    closeModal.onclick=()=>{modal.style.display='none';};

    function shareToPlatform(platform){
      const url=encodeURIComponent(window.location.href);
      let shareUrl='';
      switch(platform){
        case 'classroom': shareUrl=`https://classroom.google.com/share?url=${url}`; break;
        case 'blooket': shareUrl=`https://www.blooket.com/play?link=${url}`; break;
        case 'gimkit': shareUrl=`https://www.gimkit.com/share?url=${url}`; break;
        case 'knowt': shareUrl=`https://www.knowt.com/share?url=${url}`; break;
      }
      window.open(shareUrl,'_blank');
    }
  </script>
</body>
</html>
