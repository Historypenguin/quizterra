<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quizterra | Market</title>

  <!-- Poppins + FontAwesome -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{--sidebar-width:260px}
    html,body{height:100%;margin:0;padding:0}
    body {
      margin:0;font-family:Poppins,sans-serif;display:flex;min-height:100vh;
      background:linear-gradient(120deg,#47a7ff,#745cff,#ff4ef2);
      background-size:400% 400%;animation:gradientMove 11s ease infinite;color:white;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }
    @keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: #002b6f;
      padding: 25px;
      height: 100vh;
      box-shadow: 2px 0 10px rgba(0,0,0,0.4);
      box-sizing:border-box;
      position:fixed;
      left:0;top:0;
    }
    .sidebar h2 { font-size:40px;margin-bottom:35px;color:#0fa6ff;font-weight:900;letter-spacing:1px; }
    .sidebar a { display:flex;align-items:center;gap:14px;text-decoration:none;color:white;font-size:22px;font-weight:700;padding:12px 15px;border-radius:12px;margin-bottom:18px;transition:0.25s;cursor:pointer;}
    .sidebar a i { font-size:24px; }
    .sidebar a:hover { background: rgba(255,255,255,0.15); }
    .sidebar a.active { background: rgba(255,255,255,0.2); }

    /* Main content */
    .main { margin-left: var(--sidebar-width); padding: 50px; flex:1; box-sizing:border-box; }
    .user-info { display:flex;align-items:center;gap:20px;margin-bottom:24px; }
    .user-info img { width:80px;height:80px;border-radius:50%;border:2px solid white;object-fit:cover }
    .user-info h2 { font-size:28px;font-weight:700;margin:0 }

    /* Market */
    .market-top { display:flex;align-items:center;justify-content:space-between;gap:20px;margin-bottom:18px; flex-wrap:wrap; }
    .market-top h1 { margin:0;font-size:28px }
    .token-display { background: rgba(255,255,255,0.12); padding:10px 16px;border-radius:12px;font-weight:700; display:inline-flex;gap:8px;align-items:center; box-shadow:0 6px 18px rgba(0,0,0,0.25); }

    /* Packs */
    .packs-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap:18px; margin-top:20px; align-items:start; }
    .pack { background: rgba(255,255,255,0.12); border-radius:16px; overflow:hidden; cursor:pointer; text-align:center; padding-bottom:10px; transition: transform .18s ease, box-shadow .18s ease; box-shadow:0 8px 26px rgba(0,0,0,0.25);}
    .pack:hover { transform: translateY(-6px); box-shadow:0 18px 40px rgba(0,0,0,0.35) }
    .pack img { width:100%; height:140px; object-fit:cover; display:block; background:#fff; }
    .pack .pack-name { font-weight:700;margin-top:10px; color:white; font-size:16px }
    .pack .pack-price { margin-top:6px; background:#ffd700;color:#000;padding:6px 10px;border-radius:10px;display:inline-block;font-weight:800 }

    /* Blook display */
    .blook-grid { display:flex;flex-wrap:wrap;gap:14px;margin-top:24px; align-items:flex-start }
    .blook-card { width:120px;background:rgba(255,255,255,0.08);border-radius:12px;padding:8px;text-align:center; box-shadow:0 8px 18px rgba(0,0,0,0.2); }
    .blook-card img { width:100px;height:100px;border-radius:10px;object-fit:cover;display:block;margin:0 auto }

    /* Modal / flip cards */
    .modal { position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);backdrop-filter: blur(4px);z-index:9999;opacity:0;pointer-events:none;transition:opacity .18s; }
    .modal.show { opacity:1;pointer-events:auto }
    .open-panel { width:880px;max-width:95%;background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); padding:20px;border-radius:16px;box-shadow:0 18px 60px rgba(0,0,0,0.6);color:white; }
    .cards-row { display:flex;gap:12px;justify-content:center;align-items:center; }
    .flip-card { width:120px;height:160px;perspective:900px; }
    .flip-card-inner { position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform .9s cubic-bezier(.2,.9,.2,1); }
    .flip-card.show .flip-card-inner { transform: rotateY(180deg) }
    .flip-front, .flip-back { position:absolute;inset:0;border-radius:12px;backface-visibility:hidden;overflow:hidden;display:flex;align-items:center;justify-content:center;font-weight:700; }
    .flip-front { background:linear-gradient(135deg,#2b2b2b,#111); color:#fff }
    .flip-back { transform: rotateY(180deg); background:#fff; color:#111; display:flex;flex-direction:column;padding:8px;gap:6px;box-sizing:border-box }
    .flip-back img { width:100px;height:100px;border-radius:10px;object-fit:cover }

    /* rarity glows */
    .rarity-common {}
    .rarity-uncommon { box-shadow:0 0 18px rgba(84,255,168,0.12) }
    .rarity-rare { box-shadow:0 0 22px rgba(66,133,255,0.14) }
    .rarity-epic { box-shadow:0 0 26px rgba(169,84,255,0.18) }
    .rarity-legendary { box-shadow:0 0 34px rgba(255,200,0,0.22) }
    .rarity-chroma { box-shadow:0 0 40px rgba(255,80,200,0.26) }
    .rarity-mystical { box-shadow:0 0 48px rgba(0,255,200,0.28) }
    .rarity-heavenly { box-shadow:0 0 56px rgba(255,255,255,0.35) }
    .rarity-unique { box-shadow:0 0 38px rgba(255,0,255,0.3) }

    @media(max-width:880px){
      .open-panel { padding:14px }
      .flip-card { width:88px;height:120px }
      .flip-back img { width:72px;height:72px }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>QUIZTERRA</h2>
    <a href="stats.html"><i class="fas fa-chart-line"></i> Stats</a>
    <a href="market.html" class="active"><i class="fas fa-store"></i> Market</a>
    <a href="inventory.html"><i class="fas fa-box"></i> Inventory</a>
    <a href="sets.html"><i class="fas fa-layer-group"></i> Sets</a>
    <a id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>

  <div class="main">
    <div class="user-info">
      <img id="profilePic" src="" alt="Profile">
      <h2 id="username">USERNAME</h2>
    </div>

    <div class="market-top">
      <h1>Market</h1>
      <div class="token-display">ðŸª™ Tokens: <span id="token-count">0</span></div>
    </div>

    <div class="packs-grid" id="packs"></div>
    <div class="blook-grid" id="blook-display"></div>
  </div>

  <div class="modal" id="openModal" aria-hidden="true">
    <div class="open-panel" role="dialog" aria-modal="true">
      <h3 style="text-align:center;margin:0 0 12px 0">Opening Pack...</h3>
      <div class="cards-row" id="cardsRow"></div>
      <div style="text-align:center;margin-top:14px">
        <button id="closeOpen" style="background:#002b6f;color:white;border:none;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer">Close</button>
      </div>
    </div>
  </div>

  <script>
    // ---- User / tokens ----
    function getUser(){return JSON.parse(localStorage.getItem('quizterraUser'))}
    function saveUser(u){localStorage.setItem('quizterraUser', JSON.stringify(u))}
    function ensureUser(){
      let u = getUser();
      if(!u){ u = { username: "Guest", picture:"", stats:{ level:0,xp:0,coins:0,gamesPlayed:0,correct:0,wrong:0,lastClaim:null } }; saveUser(u);}
      return u;
    }
    const user = ensureUser();
    document.getElementById('username').innerText = user.username || "UNKNOWN";
    document.getElementById('profilePic').src = user.picture || "https://i.postimg.cc/0jz2q0qY/default-avatar.png";
    function tokenCount(){ const u=getUser(); return (u&&u.stats&&Number.isFinite(u.stats.coins))?u.stats.coins:0 }
    function setTokenCount(n){ const u=getUser()||{}; u.stats=u.stats||{}; u.stats.coins=n; saveUser(u); updateTokenUI(); }
    function updateTokens(amount){ setTokenCount(tokenCount()+amount) }
    function updateTokenUI(){ document.getElementById('token-count').innerText = tokenCount(); }
    updateTokenUI();
    document.getElementById('logoutBtn').onclick=()=>{localStorage.removeItem('quizterraUser');window.location.href='login.html'}

    // ---- Pack data (all blooks) ----
    const donutPack = [
      { name: "Glaze Donut", img: "https://i.postimg.cc/W4GVHFd7/Glaze-Donut.webp", rarity: "uncommon", chance: 30 },
      { name: "Strawberry Glazed Donut", img: "https://i.postimg.cc/B6Sr7h9q/Strawberry-Glazed-Donut.webp", rarity: "uncommon", chance: 25 },
      { name: "Chocolate Glazed Donut", img: "https://i.postimg.cc/tgXv9Yrk/Chocolate-Glazed-Donut.webp", rarity: "uncommon", chance: 20 },
      { name: "Blueberry Donut", img: "https://i.postimg.cc/HxN603Tv/Blueberry-Donut-1.webp", rarity: "rare", chance: 10 },
      { name: "Blackberry Donut", img: "https://i.postimg.cc/mZvsBy7S/Blackberry-Donut.webp", rarity: "rare", chance: 10 },
      { name: "Boston Creme", img: "https://i.postimg.cc/4x4FgY25/Boston-Creme.webp", rarity: "epic", chance: 5 },
      { name: "Donut Hole", img: "https://i.postimg.cc/6qYnLpVW/Donut-Holes.webp", rarity: "legendary", chance: 1 },
      { name: "Space Donut", img: "https://i.postimg.cc/CL9zy8Ky/Space-Donut.webp", rarity: "chroma", chance: 0.03 },
      { name: "Cinnamon Rolls", img: "https://i.postimg.cc/yN6W7wkM/cinnamon-Rolls.png", rarity: "chroma", chance: 0.03 },
      { name: "Iced Blue Donut", img: "https://i.postimg.cc/GpCtt1Yq/Iced-Blue-Donut.webp", rarity: "chroma", chance: 0.03 },
      { name: "Mystery Donut", img: "https://i.postimg.cc/25RG532M/mystery-Donut-swing-smooth.gif", rarity: "mystical", chance: 0.002 },
    ];

    const foodPack = [
      { name: "Pineapple", img: "https://i.postimg.cc/LnGkYFmx/pineapple.png", rarity: "uncommon", chance: 30 },
      { name: "Pizza", img: "https://i.postimg.cc/4Yt6p2ds/pizza.png", rarity: "uncommon", chance: 25 },
      { name: "French Pancakes", img: "https://i.postimg.cc/x1XKH8B8/french-Pancakes.png", rarity: "rare", chance: 10 },
      { name: "Popsicle", img: "https://i.postimg.cc/BQX87ypw/popsicle.png", rarity: "rare", chance: 10 },
      { name: "Cookie", img: "https://i.postimg.cc/RVk0s0NN/cookie.png", rarity: "epic", chance: 5 },
      { name: "Breakfast Sandwich", img: "https://i.postimg.cc/Bb3gB3Hy/breakfast-Sandwich.png", rarity: "legendary", chance: 1 },
      { name: "Chocolate Bar", img: "https://i.postimg.cc/DWTq6QJs/chocolate-Bar.png", rarity: "chroma", chance: 0.05 },
      { name: "Chef", img: "https://i.postimg.cc/gnxq22bw/chef.png", rarity: "chroma", chance: 0.03 },
    ];

    const ogPack = [
      { name: "Bagel Penguin", img: "https://i.postimg.cc/Fk7KBcZh/bagel-Penguin.png", rarity: "uncommon", chance: 30 },
      { name: "Chip", img: "https://i.postimg.cc/8FNzVxHK/chip.png", rarity: "uncommon", chance: 30 },
      { name: "History Penguin", img: "https://i.postimg.cc/8zc7hLFX/Picsart-25-08-18-11-05-20-062.webp", rarity: "uncommon", chance: 30 },
      { name: "Noodles", img: "https://i.postimg.cc/18p32ypV/noodles.png", rarity: "rare", chance: 20 },
      { name: "Octayden", img: "https://i.postimg.cc/7GB69XSB/octayden.png", rarity: "rare", chance: 20 },
      { name: "Ayden", img: "https://i.postimg.cc/mt1D3Ykw/ayden.png", rarity: "rare", chance: 20 },
      { name: "Fasty Jay", img: "https://i.postimg.cc/CxdBTLqj/Untitled-design-13.png", rarity: "epic", chance: 10 },
      { name: "Mystical", img: "https://i.postimg.cc/zymfxyR1/mystical.png", rarity: "epic", chance: 10 },
      { name: "Panda Flame", img: "https://i.postimg.cc/8cKptMwx/Screen-Shot-2025-08-01-at-6-49-29-AM.webp", rarity: "legendary", chance: 1 },
      { name: "Spork", img: "https://i.postimg.cc/cKB6gdCG/spork.png", rarity: "legendary", chance: 1 },
      { name: "SpeedGoodAlr", img: "https://i.postimg.cc/t7T7JQH8/speed-Good-Alr.png", rarity: "chroma", chance: 0.05 },
      { name: "Caterpillar9", img: "https://i.postimg.cc/KkcjtC3k/caterpillar9.png", rarity: "chroma", chance: 0.05 },
      { name: "GhostRider", img: "https://files.catbox.moe/paegps.png", rarity: "chroma", chance: 0.05 },
      { name: "Allonme", img: "https://i.postimg.cc/1z2Pv8pL/allonme.png", rarity: "mystical", chance: 0.002 },
      { name: "Blooket Warrior", img: "https://i.postimg.cc/htNhD5Z3/Blooket-Warrior.gif", rarity: "heavenly", chance: 0.0002 }
    ];

    const packs = [
      { id:'donut-pack', title:'Donut Pack', data:donutPack, price:50, img:'https://i.postimg.cc/N0znbQ4x/donut-Pack.png' },
      { id:'food-pack', title:'Food Pack', data:foodPack, price:25, img:'https://i.postimg.cc/NF8d3FQB/foodPack.png' },
      { id:'og-pack', title:'OG Pack', data:ogPack, price:15, img:'https://i.postimg.cc/76kp7h17/download-6.png' },
    ];

    const packsEl = document.getElementById('packs');
    packsEl.innerHTML='';
    packs.forEach(p=>{
      const d=document.createElement('div');
      d.className='pack';
      d.id=p.id;
      d.innerHTML=`<img src="${p.img}" alt="${p.title}"><div class="pack-name">${p.title}</div><div class="pack-price">ðŸ’° ${p.price} Tokens</div>`;
      d.addEventListener('click', ()=>buyPack(p));
      packsEl.appendChild(d);
    });

    function buyPack(pack){
      if(tokenCount()<pack.price){ alert('Not enough tokens!'); return; }
      updateTokens(-pack.price);
      openPackAnimated(pack.data);
    }

    function pickOne(packData){
      const total = packData.reduce((s,b)=>s+(Number(b.chance)||0),0);
      let r = Math.random()*total;
      for(const b of packData){
        if(r < b.chance) return b;
        r -= b.chance;
      }
      return packData[0];
    }

    const modal = document.getElementById('openModal');
    const cardsRow = document.getElementById('cardsRow');
    document.getElementById('closeOpen').onclick=()=>{modal.classList.remove('show');}

    function createFlipCard(){
      const wrapper=document.createElement('div');
      wrapper.className='flip-card';
      wrapper.innerHTML=`<div class="flip-card-inner"><div class="flip-front"><i class="fas fa-box-open" style="font-size:28px;color:#ddd"></i></div><div class="flip-back"><img src="https://i.postimg.cc/placeholder.png" alt="" /><div style="font-size:13px;font-weight:700;margin-top:6px">Name</div></div></div>`;
      return wrapper;
    }

    function openPackAnimated(packData){
      cardsRow.innerHTML=''; 
      const slots=5;
      const results=[];
      for(let i=0;i<slots;i++) results.push(pickOne(packData));

      const cardWrappers=[];
      for(let i=0;i<slots;i++){
        const fc=createFlipCard();
        cardWrappers.push(fc);
        cardsRow.appendChild(fc);
      }

      modal.classList.add('show');

      cardWrappers.forEach((wrapper,idx)=>{
        setTimeout(()=>{
          const inner=wrapper.querySelector('.flip-card-inner');
          const back=wrapper.querySelector('.flip-back');
          const img=back.querySelector('img');
          const nameDiv=back.querySelector('div');
          const r=results[idx];
          img.src=r.img; nameDiv.innerText=r.name;
          back.classList.add('rarity-'+(r.rarity||'common'));
          wrapper.classList.add('show');
          addToInventory(r);
        },700+idx*600);
      });

      setTimeout(()=> displayResults(results), 700+slots*600+250);
    }

    function displayResults(results){
      const grid=document.getElementById('blook-display');
      results.forEach(r=>{
        const card=document.createElement('div');
        card.className='blook-card';
        const rarityClass='rarity-'+(r.rarity||'common');
        card.innerHTML=`<div style="border-radius:10px;overflow:hidden" class="${rarityClass}"><img src="${r.img}" alt="${r.name}"></div><div style="margin-top:6px;font-weight:700">${r.name}</div>`;
        grid.prepend(card);
      });
    }

    function addToInventory(blook){
      const u=getUser()||{};
      if(!u.inventory) u.inventory=[];
      u.inventory.push(blook);
      saveUser(u);
    }

  </script>
</body>
</html>
