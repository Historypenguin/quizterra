<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quizterra | My Sets</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body {
      margin: 0;
      font-family: Poppins, sans-serif;
      display: flex;
      height: 100vh;
      background: linear-gradient(120deg, #47a7ff, #745cff, #ff4ef2);
      background-size: 400% 400%;
      animation: gradientMove 11s ease infinite;
      color: white;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .sidebar {
      width: 260px;
      background: #002b6f;
      padding: 25px;
      height: 100vh;
      box-shadow: 2px 0 10px rgba(0,0,0,0.4);
    }
    .sidebar h2 {
      font-size: 40px;
      margin-bottom: 35px;
      color: #0fa6ff;
      font-weight: 900;
    }
    .sidebar a {
      display: flex;
      align-items: center;
      gap: 14px;
      color: white;
      text-decoration: none;
      font-size: 22px;
      font-weight: 700;
      padding: 12px 15px;
      border-radius: 12px;
      margin-bottom: 18px;
      transition: 0.25s;
    }
    .sidebar a:hover { background: rgba(255,255,255,0.15); }
    .sidebar a.active { background: rgba(255,255,255,0.2); }

    .main {
      flex: 1;
      padding: 50px;
      overflow-y: auto;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .create-btn {
      background: rgba(255,255,255,0.25);
      padding: 14px 22px;
      border: none;
      border-radius: 12px;
      font-size: 20px;
      font-weight: 700;
      cursor: pointer;
      color: white;
      transition: 0.3s;
    }
    .create-btn:hover {
      background: rgba(255,255,255,0.35);
      transform: scale(1.05);
    }

    .sets-grid {
      margin-top: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 25px;
    }

    .set-card {
      background: rgba(255,255,255,0.18);
      padding: 20px;
      border-radius: 18px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      transition: 0.3s;
    }
    .set-card h3 {
      margin: 0 0 10px 0;
      font-size: 22px;
      font-weight: 700;
    }
    .set-card p { font-size: 15px; opacity: .9; }

    .card-btns {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .card-btns button {
      padding: 8px 14px;
      border-radius: 25px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
      font-size: 14px;
    }

    .edit-btn { background: #ffa500; color: white; }
    .edit-btn:hover { background: #ffb733; transform: scale(1.05); }

    .delete-btn { background: #ff4e4e; color: white; }
    .delete-btn:hover { background: #ff6b6b; transform: scale(1.05); }

    .play-btn { background: #00ff95; color: black; }
    .play-btn:hover { background: #33ffaa; transform: scale(1.05); }

    /* Create Set Form */
    #createSetForm {
      display: none;
      margin-top: 30px;
      background: rgba(255,255,255,0.2);
      padding: 20px;
      border-radius: 18px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    .question-block {
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 14px;
      margin-bottom: 20px;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }
    #createSetForm button {
      background: #00ff95;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      font-weight: 700;
      border-radius: 12px;
      cursor: pointer;
      transition: 0.3s;
    }
    #createSetForm button:hover { transform: scale(1.05); }
  </style>
</head>

<body>

  <div class="sidebar">
    <h2>QUIZTERRA</h2>
    <a href="stats.html"><i class="fas fa-chart-line"></i> Stats</a>
    <a href="market.html"><i class="fas fa-store"></i> Market</a>
    <a href="inventory.html"><i class="fas fa-box"></i> Inventory</a>
    <a href="sets.html" class="active"><i class="fas fa-layer-group"></i> Sets</a>
    <a id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>

  <div class="main">
    <div class="top-row">
      <h1>My Sets</h1>
      <button class="create-btn" onclick="toggleCreateForm()">+ Create Set</button>
    </div>

    <!-- Create Set Form -->
    <div id="createSetForm">
      <h2>Create New Set</h2>

      <input type="text" id="setName" placeholder="Set Name">

      <div id="questionsContainer"></div>

      <button onclick="addQuestion()">+ Add Question</button>
      <br><br>
      <button id="saveSetBtn" onclick="createSet()">Save Set</button>
    </div>

    <div class="sets-grid" id="setsGrid"></div>
  </div>

<script>
let user = JSON.parse(localStorage.getItem("quizterraUser"));
if (!user) window.location = "login.html";

let sets = JSON.parse(localStorage.getItem("quizterraSets")) || [];

function loadSets() {
  const container = document.getElementById("setsGrid");
  container.innerHTML = "";

  const mySets = sets.filter(s => s.owner === user.username);

  if (mySets.length === 0) {
    container.innerHTML = "<h2>You have no sets. Create one!</h2>";
    return;
  }

  mySets.forEach(set => {
    container.innerHTML += `
      <div class="set-card">
        <h3>${set.name}</h3>
        <p>${set.questions.length} Questions</p>
        <div class="card-btns">
          <button class="edit-btn" onclick="editSet('${set.id}')">Edit</button>
          <button class="delete-btn" onclick="deleteSet('${set.id}')">Delete</button>
          <button class="play-btn" onclick="playSet('${set.id}')">Play</button>
        </div>
      </div>
    `;
  });
}

function toggleCreateForm() {
  document.getElementById("createSetForm").style.display =
    document.getElementById("createSetForm").style.display === "none"
      ? "block"
      : "none";
}

function addQuestion() {
  const container = document.getElementById("questionsContainer");

  const html = `
    <div class="question-block">
      <input type="text" class="q-text" placeholder="Question Text">
      <input type="text" class="q-img" placeholder="Image/GIF URL (optional)">
      <input type="text" class="opt1" placeholder="Option 1">
      <input type="text" class="opt2" placeholder="Option 2">
      <input type="text" class="opt3" placeholder="Option 3">
      <input type="text" class="opt4" placeholder="Option 4">
      <select class="q-correct">
        <option value="0">Correct Answer: Option 1</option>
        <option value="1">Correct Answer: Option 2</option>
        <option value="2">Correct Answer: Option 3</option>
        <option value="3">Correct Answer: Option 4</option>
      </select>
    </div>
  `;

  container.insertAdjacentHTML("beforeend", html);
}

function createSet() {
  const name = document.getElementById("setName").value.trim();
  if (!name) return alert("Enter a set name.");

  const blocks = [...document.querySelectorAll(".question-block")];
  if (blocks.length === 0) return alert("Add at least one question.");

  const questionData = blocks.map(block => {
    return {
      question: block.querySelector(".q-text").value.trim(),
      image: block.querySelector(".q-img").value.trim(),
      options: [
        block.querySelector(".opt1").value.trim(),
        block.querySelector(".opt2").value.trim(),
        block.querySelector(".opt3").value.trim(),
        block.querySelector(".opt4").value.trim()
      ],
      correct: Number(block.querySelector(".q-correct").value)
    };
  });

  const newSet = {
    id: Date.now().toString(),
    name,
    owner: user.username,
    questions: questionData
  };

  sets.push(newSet);
  localStorage.setItem("quizterraSets", JSON.stringify(sets));

  alert("Set Created!");
  location.reload();
}

function editSet(id) {
  const set = sets.find(s => s.id === id);
  if (!set) return alert("Set not found!");

  toggleCreateForm();

  document.getElementById("setName").value = set.name;
  const container = document.getElementById("questionsContainer");
  container.innerHTML = ""; 

  set.questions.forEach(q => {
    const html = `
      <div class="question-block">
        <input type="text" class="q-text" placeholder="Question Text" value="${q.question}">
        <input type="text" class="q-img" placeholder="Image/GIF URL (optional)" value="${q.image}">
        <input type="text" class="opt1" placeholder="Option 1" value="${q.options[0]}">
        <input type="text" class="opt2" placeholder="Option 2" value="${q.options[1]}">
        <input type="text" class="opt3" placeholder="Option 3" value="${q.options[2]}">
        <input type="text" class="opt4" placeholder="Option 4" value="${q.options[3]}">
        <select class="q-correct">
          <option value="0" ${q.correct===0?'selected':''}>Correct Answer: Option 1</option>
          <option value="1" ${q.correct===1?'selected':''}>Correct Answer: Option 2</option>
          <option value="2" ${q.correct===2?'selected':''}>Correct Answer: Option 3</option>
          <option value="3" ${q.correct===3?'selected':''}>Correct Answer: Option 4</option>
        </select>
      </div>
    `;
    container.insertAdjacentHTML("beforeend", html);
  });

  const saveBtn = document.getElementById("saveSetBtn");
  saveBtn.textContent = "Update Set";

  saveBtn.onclick = function() {
    const name = document.getElementById("setName").value.trim();
    if (!name) return alert("Enter a set name.");

    const blocks = [...document.querySelectorAll(".question-block")];
    if (blocks.length === 0) return alert("Add at least one question.");

    const questionData = blocks.map(block => {
      return {
        question: block.querySelector(".q-text").value.trim(),
        image: block.querySelector(".q-img").value.trim(),
        options: [
          block.querySelector(".opt1").value.trim(),
          block.querySelector(".opt2").value.trim(),
          block.querySelector(".opt3").value.trim(),
          block.querySelector(".opt4").value.trim()
        ],
        correct: Number(block.querySelector(".q-correct").value)
      };
    });

    set.name = name;
    set.questions = questionData;
    localStorage.setItem("quizterraSets", JSON.stringify(sets));

    alert("Set Updated!");
    location.reload();
  };
}

function playSet(id) {
  window.location = `https://historypenguin.github.io/quizterra/play.html?setId=${id}`;
}

function deleteSet(id) {
  if (confirm("Delete this set?")) {
    sets = sets.filter(s => s.id != id);
    localStorage.setItem("quizterraSets", JSON.stringify(sets));
    loadSets();
  }
}

document.getElementById("logoutBtn").onclick = () => {
  localStorage.removeItem("quizterraUser");
  window.location = "login.html";
};

loadSets();
</script>

</body>
</html>
