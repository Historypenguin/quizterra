<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quizterra | Inventory</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: Poppins, sans-serif;
    margin: 0;
    padding: 20px;
    background: #f0f2f5;
  }
  h1 { text-align: center; }
  .inventory { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
  .item {
    border: 2px solid #ccc;
    border-radius: 10px;
    padding: 15px;
    width: 180px;
    text-align: center;
    background: white;
  }
  button {
    margin: 5px 0;
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  .sell-btn { background: #ff6b6b; color: white; }
  .profile-btn { background: #4dabf7; color: white; }
</style>
</head>
<body>

<h1>My Inventory</h1>
<p id="token-count" style="text-align:center;font-weight:bold;"></p>
<div id="inventory" class="inventory"></div>

<script>
  // Safe localStorage setup
  const storage = JSON.parse(localStorage.getItem('quizterraStorage') || '{}');
  const currentUser = localStorage.getItem('quizterraCurrentUser') || 'Guest';

  // Initialize user data if not present
  if (!storage[currentUser]) {
    storage[currentUser] = {
      tokens: 0,
      inventory: {},
      profileItem: null
    };
    localStorage.setItem('quizterraStorage', JSON.stringify(storage));
  }

  const userData = storage[currentUser];

  const rarityValues = {
    "uncommon": 5,
    "rare": 20,
    "epic": 75,
    "legendary": 200,
    "chroma": 300,
    "unique": 400,
    "mystical": 1000,
    "heavenly": 2000
  };

  const inventoryDiv = document.getElementById('inventory');
  const tokenCount = document.getElementById('token-count');

  function renderInventory() {
    inventoryDiv.innerHTML = '';
    tokenCount.textContent = `Tokens: ${userData.tokens}`;

    if (Object.keys(userData.inventory).length === 0) {
      inventoryDiv.innerHTML = '<p>Your inventory is empty!</p>';
      return;
    }

    for (let [itemName, itemData] of Object.entries(userData.inventory)) {
      const itemDiv = document.createElement('div');
      itemDiv.classList.add('item');
      const quantity = itemData.quantity;
      const sellValue = rarityValues[itemData.rarity] * quantity;

      itemDiv.innerHTML = `
        <h3>${itemName}</h3>
        <p>Rarity: ${itemData.rarity}</p>
        <p>Quantity: ${quantity}</p>
        <p>Sell for ${sellValue} tokens</p>
        <button class="sell-btn">Sell</button>
        <button class="profile-btn">${userData.profileItem === itemName ? 'Profile Set' : 'Set as Profile'}</button>
      `;

      // Sell button
      itemDiv.querySelector('.sell-btn').addEventListener('click', () => {
        userData.tokens += sellValue;
        delete userData.inventory[itemName];
        saveData();
        renderInventory();
        alert(`Sold ${itemName} for ${sellValue} tokens!`);
      });

      // Set as profile button
      itemDiv.querySelector('.profile-btn').addEventListener('click', () => {
        userData.profileItem = itemName;
        saveData();
        renderInventory();
        alert(`${itemName} set as profile item!`);
      });

      inventoryDiv.appendChild(itemDiv);
    }
  }

  function saveData() {
    storage[currentUser] = userData;
    localStorage.setItem('quizterraStorage', JSON.stringify(storage));
  }

  renderInventory();
</script>

</body>
</html>
