<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory | Quizterra</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Titan+One&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="https://i.postimg.cc/DwTNfscc/foodit-Logo.png">
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: linear-gradient(to bottom right, #6a11cb, #2575fc);
      color: orange;
      display: flex;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .sidebar {
      background: #3a0ca3;
      color: white;
      width: 220px;
      min-height: 100vh;
      padding: 20px 15px;
      position: fixed;
      font-family: 'Titan One', cursive;
      top: 0;
      left: 0;
      transition: transform 0.3s ease;
      z-index: 9999;
    }
    .sidebar.hide { transform: translateX(-230px); }
    .sidebar .logo { font-size: 40px; font-weight: bold; margin-bottom: 30px; }
    .sidebar a {
      display: flex;
      align-items: center;
      font-size: 20px;
      text-decoration: none;
      color: white;
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      transition: background 0.3s ease;
    }
    .sidebar a i { margin-right: 10px; }
    .sidebar a:hover { background: rgba(255, 255, 255, 0.15); }
    .sidebar a.active { background: #7209b7; }
    .main {
      margin-left: 220px;
      padding: 30px 20px;
      flex-grow: 1;
      display: flex;
      gap: 30px;
      transition: margin-left 0.3s ease;
    }
    .blooks-list {
      flex: 1;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 10px;
      padding: 15px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .blooks-list h2 {
      font-family: 'Titan One', cursive;
      font-size: 24px;
      margin-top: 0;
      margin-bottom: 5px;
      border-bottom: 2px solid white;
      padding-bottom: 5px;
    }
    .blooks-list .unlocked-count {
      font-size: 16px;
      margin-bottom: 15px;
      font-family: 'Titan One', cursive;
      color: #fff5cc;
    }
    .pack-section { margin-bottom: 25px; }
    .pack-title {
      font-family: 'Titan One', cursive;
      font-size: 22px;
      margin-bottom: 10px;
      border-bottom: 2px solid white;
      padding-bottom: 4px;
    }
    .blooks-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .blook-item {
      width: 120px;
      background: rgba(255, 255, 255, 0.25);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .blook-item:hover { background: rgba(255, 255, 255, 0.4); }
    .blook-item img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      background: white;
      border-radius: 8px;
      margin-bottom: 6px;
    }
    .blook-name {
      font-family: 'Titan One', cursive;
      font-size: 16px;
      color: white;
    }
    .rarity { font-size: 12px; font-style: italic; margin-top: 2px; text-transform: capitalize; }
    .rarity.common { color: #FFFFFF; }
    .rarity.uncommon { color: #28a745; }
    .rarity.rare { color: #007bff; }
    .rarity.epic { color: #dc3545; }
    .rarity.legendary { color: #fd7e14; }
    .rarity.chroma { color: #17c3c9; }
    .rarity.unique { color: #008080; }
    .rarity.mystical { color: #6f42c1; }
    .rarity.heavenly { color: #e83e8c; }
    .details-panel {
      flex: 1;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 10px;
      padding: 20px;
      display: none;
      flex-direction: column;
      align-items: center;
    }
    .details-panel img {
      width: 160px;
      height: 160px;
      object-fit: contain;
      background: white;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .details-name { font-size: 26px; font-family: 'Titan One', cursive; }
    .sell-button {
      background: #7209b7;
      border: none;
      color: white;
      font-family: 'Titan One', cursive;
      font-size: 18px;
      padding: 10px 25px;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px 0;
    }
    #sell-qty {
      font-size: 16px;
      padding: 8px;
      width: 120px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: none;
      text-align: center;
    }
    .token-limit { margin-top: -5px; font-size: 14px; color: #ffcc99; }
    #hamburger {
      display: none;
      position: fixed;
      top: 15px;
      left: 15px;
      font-size: 28px;
      color: white;
      background-color: #7209b7;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      z-index: 10000;
    }
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-230px); position: fixed; }
      .sidebar.show { transform: translateX(0); }
      .main { margin-left: 0; padding: 20px 15px; }
      #hamburger { display: block; }
    }
  </style>
</head>
<body>
  <button id="hamburger" aria-label="Toggle menu"><i class="fas fa-bars"></i></button>

  <div class="sidebar" id="sidebar">
    <div class="logo">QUIZTERRA</div>
    <a href="stats.html"><i class="fas fa-chart-line"></i> Stats</a>
    <a href="market.html"><i class="fas fa-store"></i> Market</a>
    <a href="inventory.html" class="active"><i class="fas fa-utensils"></i> Inventory</a>
    <a href="chat.html"><i class="fas fa-comment"></i> Chat</a>
    <a href="settings.html"><i class="fas fa-cog"></i> Settings</a>
    <a href="#" id="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>

  <div class="main" id="main-content">
    <div class="blooks-list">
      <h2>Your Items</h2>
      <div class="unlocked-count">Unlocked: <span id="unlocked">0</span></div>
      <div id="blooks-container"></div>
    </div>
    <div class="details-panel" id="details-panel">
      <img id="detail-img" src="" alt="Item Image">
      <div class="details-name" id="detail-name"></div>
      <input type="number" id="sell-qty" placeholder="How many to sell" min="1">
      <div class="token-limit" id="token-limit-text"></div>
      <button class="sell-button" id="sell-button">Sell</button>
      <button class="sell-button" id="set-profile">Set Profile</button>
    </div>
  </div>

  <script>
    const container = document.getElementById("blooks-container");
    const panel = document.getElementById("details-panel");
    const detailImg = document.getElementById("detail-img");
    const detailName = document.getElementById("detail-name");
    const sellBtn = document.getElementById("sell-button");
    const profileBtn = document.getElementById("set-profile");
    const sellQtyInput = document.getElementById("sell-qty");
    const tokenLimitText = document.getElementById("token-limit-text");
    const hamburger = document.getElementById("hamburger");
    const sidebar = document.getElementById("sidebar");

    hamburger.addEventListener("click", () => sidebar.classList.toggle("show"));

    function getAllUsers() {
      const raw = localStorage.getItem("quizterraStorage");
      return raw ? JSON.parse(raw) : {};
    }

    function getCurrentUserName() { 
      return localStorage.getItem("quizterraUser"); 
    }

    function getCurrentUser() {
      const users = getAllUsers();
      const user = getCurrentUserName();
      return user && users[user] ? users[user] : null;
    }

    function saveCurrentUser(userData) {
      const users = getAllUsers();
      const user = getCurrentUserName();
      if (!user) return;
      users[user] = userData;
      localStorage.setItem("quizterraStorage", JSON.stringify(users));
    }

    function getSellPrice(rarity) {
      switch ((rarity||"").toLowerCase()) {
        case "common": return 1;
        case "uncommon": return 5;
        case "rare": return 20;
        case "epic": return 75;
        case "legendary": return 200;
        case "chroma": return 300;
        case "unique": return 500;
        case "mystical": return 1000;
        case "heavenly": return 2000;
        default: return 1;
      }
    }

    let selectedBlook = null;
    let selectedCount = 1;
    let maxSellQty = 1;

    function showBlooks() {
      const user = getCurrentUser();
      if (!user || !user.blooks || user.blooks.length === 0) {
        container.innerHTML = "<p style='color:white;'>You haven't unlocked any items yet!</p>";
        panel.style.display = "none";
        document.getElementById("unlocked").textContent = 0;
        return;
      }

      const counts = {};
      user.blooks.forEach(b => { const key = b.name+"|"+b.img; counts[key] = (counts[key]||0)+1; });
      const uniqueBlooksMap = new Map();
      user.blooks.forEach(b => { const key=b.name+"|"+b.img; if(!uniqueBlooksMap.has(key)) uniqueBlooksMap.set(key,b); });

      container.innerHTML = "";
      let unlockedCount = 0;

      uniqueBlooksMap.forEach(blook => {
        unlockedCount++;
        const count = counts[blook.name+"|"+blook.img];
        const div = document.createElement("div");
        div.className = "blook-item";
        const rarityClass = blook.rarity ? blook.rarity.toLowerCase() : "";
        div.innerHTML = `<img src="${blook.img}" alt="${blook.name}" /><div class="blook-name">${blook.name}${count>1?` x${count}`:""}<div class="rarity ${rarityClass}">${blook.rarity||"Unknown"}</div></div>`;
        div.onclick = () => {
          selectedBlook=blook; selectedCount=count; maxSellQty=selectedCount;
          detailImg.src=blook.img; detailName.textContent=blook.name;
          sellQtyInput.value=1; tokenLimitText.textContent=`You own ${selectedCount}.`;
          panel.style.display="flex"; if(window.innerWidth<=768) sidebar.classList.remove("show");
        };
        container.appendChild(div);
      });

      document.getElementById("unlocked").textContent = unlockedCount;
    }

    sellBtn.onclick = () => {
      const qty = Math.min(parseInt(sellQtyInput.value)||1, maxSellQty);
      if (!selectedBlook || qty <= 0) return;
      const user = getCurrentUser(); if(!user) return;

      let removed = 0;
      user.blooks = user.blooks.filter(b => {
        if (removed<qty && b.name===selectedBlook.name && b.img===selectedBlook.img) { removed++; return false; }
        return true;
      });

      user.tokens = (user.tokens||0) + (qty*getSellPrice(selectedBlook.rarity));
      saveCurrentUser(user);
      showBlooks();
      panel.style.display="none";
    };

    profileBtn.onclick = () => {
      if (!selectedBlook) return;
      const users = getAllUsers();
      const currentUser = getCurrentUserName();
      if (!currentUser || !users[currentUser]) return;

      users[currentUser].profileBlook = {
        name: selectedBlook.name,
        img: selectedBlook.img,
        rarity: selectedBlook.rarity
      };

      localStorage.setItem("quizterraStorage", JSON.stringify(users));
      alert(`${selectedBlook.name} is now your profile!`);
    };

    document.getElementById("logout-link").onclick = () => {
      localStorage.removeItem("quizterraUser");
      window.location.href = "login.html";
    };

    showBlooks();
  </script>
</body>
</html>
