<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quizterra | Inventory</title>
<style>
  body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
  h1 { text-align:center; }
  .item { background:white; padding:15px; margin:10px; border-radius:10px; display:inline-block; width:180px; text-align:center; }
  button { margin:5px; padding:5px 10px; cursor:pointer; }
  .sell { background:red; color:white; border:none; border-radius:5px; }
  .profile { background:blue; color:white; border:none; border-radius:5px; }
</style>
</head>
<body>

<h1>Inventory</h1>
<p id="tokens" style="text-align:center;font-weight:bold;"></p>
<div id="inventory"></div>

<script>
const currentUser = localStorage.getItem('quizterraCurrentUser') || 'Guest';
let storage = JSON.parse(localStorage.getItem('quizterraStorage') || '{}');

// Initialize user
if (!storage[currentUser]) {
  storage[currentUser] = { tokens: 0, inventory: {}, profileItem: null };
  localStorage.setItem('quizterraStorage', JSON.stringify(storage));
}

let user = storage[currentUser];

const rarityValues = {
  "uncommon":5, "rare":20, "epic":75, "legendary":200,
  "chroma":300, "unique":400, "mystical":1000, "heavenly":2000
};

const inventoryDiv = document.getElementById('inventory');
const tokensDisplay = document.getElementById('tokens');

function save() {
  storage[currentUser] = user;
  localStorage.setItem('quizterraStorage', JSON.stringify(storage));
}

function render() {
  tokensDisplay.textContent = `Tokens: ${user.tokens}`;
  inventoryDiv.innerHTML = '';
  if(Object.keys(user.inventory).length===0){
    inventoryDiv.innerHTML = '<p style="text-align:center;">Inventory empty!</p>';
    return;
  }
  for(const [name,data] of Object.entries(user.inventory)){
    const div = document.createElement('div');
    div.className='item';
    const sellAmount = rarityValues[data.rarity]*data.quantity;
    div.innerHTML=`
      <h3>${name}</h3>
      <p>Rarity: ${data.rarity}</p>
      <p>Qty: ${data.quantity}</p>
      <p>Sell: ${sellAmount} tokens</p>
      <button class="sell">Sell</button>
      <button class="profile">${user.profileItem===name?'Profile Set':'Set Profile'}</button>
    `;
    div.querySelector('.sell').onclick = ()=>{
      user.tokens+=sellAmount;
      delete user.inventory[name];
      save();
      render();
      alert(`Sold ${name} for ${sellAmount} tokens`);
    };
    div.querySelector('.profile').onclick = ()=>{
      user.profileItem = name;
      save();
      render();
      alert(`${name} set as profile item`);
    };
    inventoryDiv.appendChild(div);
  }
}

render();
</script>
</body>
</html>
